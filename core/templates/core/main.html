{% extends 'core/index.html' %}
{% load static %}

{% block title %}
Main posts
{% endblock %}

{% block import %}
    <link rel='stylesheet' href="{% static 'css/main.css' %}">
{% endblock %}

{% block main %}
    <h1>Main posts</h1>

    {% if user %}
        {% if user.can_post %}
            <a href='write_post'>Write post</a>
        {% endif %}
    {% else %}
        <a href='signup'>Signup to comment on posts</a>
    {% endif %}

    <hr>

    <div id='posts'>
        {% if posts|length %}
            {% for post in posts %} 
                {% if post.public or post.author == user %}
                    <div id='post'>
                        <p>Written by {{post.author.username}} in {{post.datetime}}</p>

                        {% if not post.public %}
                            <p>This post is private</p>
                        {% endif %}

                        <h1>{{post.title}}</h1>

                        {% for line in post.break_content %}
                            {% if line.0 == '#' %}
                                <b>{{line|slice:'1:'}}</b>
                            {% elif line.0 == '$' %}
                                <i>{{line|slice:'1:'}}</i>
                            {% elif line.0 == '%' %}
                                <u>{{line|slice:'1:'}}</u>
                            {% else %}
                                {{line}}
                            {% endif %}
                            <br>
                        {% endfor %}

                        <div id='links'>
                            {% if post.author == user %}
                                <a href='edit/{{post.id}}'>Edit Post</a>
                            {% endif %}
                            
                            <a href='post/{{post.id}}'>See post</a>
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
        {% else %} 
            <p>There are no posts</p>
        {% endif %} 
    </div>
{% endblock %}

